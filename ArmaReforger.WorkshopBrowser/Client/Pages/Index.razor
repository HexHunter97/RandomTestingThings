@page "/"
@using ArmaReforger.WorkshopBrowser.Client.Interfaces
@using ArmaReforger.WorkshopBrowser.Client.Dtos
@using ArmaReforger.WorkshopBrowser.Client.Models

<PageTitle>ARMA: Reforged Workshop Browser</PageTitle>

@if (!Loaded)
{
    <Loading/>
}
else
{
    <CenterColumn>
        <MudChip Color="Color.Primary" Style="transition-property: none; pointer-events: none;">
            <MudText Typo="Typo.h6" Class="mud-text-primary">
                All mods: @Assets.Count
            </MudText>
        </MudChip>
    </CenterColumn>
    @foreach (var asset in Assets.Rows)
    {
        <AssetRow Asset="asset"/>
    }
}

@code 
{
    [Inject]
    public IWorkshopReader WorkshopReader { get; set; } = default!;

    public bool Loaded { get; set; }
    public AssetsResponse Assets { get; set; } = default!;
    
    protected override async Task OnInitializedAsync()
    {
        // TODO: implement POST based filtering (see mitmproxy results!)
        Assets = await WorkshopReader.GetPagedAssets(new Pagination());
        Loaded = true;
    }
}
